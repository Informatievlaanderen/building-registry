namespace BuildingRegistry.Tests
{
    using Be.Vlaanderen.Basisregisters.Utilities.HexByteConvertor;
    using FluentAssertions;
    using NetTopologySuite.Geometries;
    using Xunit;

    public class PolygonTests
    {
        private Geometry? _polygonSelfTouchingRingFormingHoles;

        public PolygonTests()
        {
            _polygonSelfTouchingRingFormingHoles = WKBReaderFactory.Create().Read(
                "0103000000020000001900000000F40D5303BBEF400057C7CECA67044100C477694BBBEF40806D4A56D467044100701B1455BBEF408081A8D8CF67044100CCDDB50CBBEF408004D824C6670441004053B650BBEF40007FB4DCA86704410094111E95BBEF40003E8A17B267044100C836B0DDBBEF408003885F906704410044AF46FEBBEF400006AF3A81670441009432B056BCEF40803090448E6704410080367952BCEF40007AD6129167044100742CF63FBCEF40008C7A659D67044100842D28D4BFEF408072A1CF1668044100101BDED4BFEF408076BFE71668044100889110EDBFEF4000DFA61C1A680441003C337389BFEF40800801D64968044100902690DABEEF400066E39E9D680441001006A530BBEF4000C45D9A2168044100AC2CD84EBBEF4080FE258613680441000443EBE9B8EF4080B25A3DC667044100F0454970B9EF40806B1AB88267044100A8579886BAEF4080787054A567044100BC857CB8BAEF400014C588AB6704410078EFAF26BBEF40008F2C3DB967044100CCDDB50CBBEF408004D824C667044100F40D5303BBEF400057C7CECA670441070000000078DCF7F0BBEF4080FEA82A936704410030432320BCEF4080EE4F86996704410090EF9220BCEF400057A63C9967044100E876362CBCEF4000BDB99C91670441005CCF1703BCEF4080C04D238C6704410074D36DF1BBEF40009B2DFD926704410078DCF7F0BBEF4080FEA82A93670441"
                    .ToByteArray());
        }

        [Fact]
        public void GivenPolygonWithSelfTouchingRingFormingHoles_ThenNTSPolygonIsNotValid()
        {
            var polygon = _polygonSelfTouchingRingFormingHoles as Polygon;

            polygon.IsValid.Should().BeFalse();
        }

        [Fact]
        public void GivenPolygonWithSelfTouchingRingFormingHoles_ThenGrbPolygonIsValid()
        {
            var polygon = _polygonSelfTouchingRingFormingHoles as Polygon;
            var grbPolygon = new GrbPolygon(polygon);

            grbPolygon.IsValid.Should().BeTrue();
        }
    }
}
